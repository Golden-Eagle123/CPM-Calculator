<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CPM Calculator</title>
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#111827" />
  <style>
    * { box-sizing: border-box; }
    body { font-family: -apple-system, system-ui, Segoe UI, Roboto, Arial; margin: 0; background:#0b1020; color:#e5e7eb; }
    .wrap { max-width: 520px; margin: 0 auto; padding: 20px; }
    .card { background:#111827; border:1px solid #1f2937; border-radius:16px; padding:16px; box-shadow: 0 10px 20px rgba(0,0,0,.25);}
    h1 { font-size: 18px; margin: 0 0 12px; }
    label { display:block; font-size: 12px; color:#9ca3af; margin-top:12px; }
    input { width:100%; max-width: 100%; display: block;font-size:16px; padding:12px; border-radius:12px; border:1px solid #374151; background:#0b1220; color:#e5e7eb; }
    .row{
      display:grid;
      grid-template-columns: minmax(0,1fr) minmax(0,1fr);
      gap:12px;
      align-items:start;
    }
    .out { margin-top:14px; padding:12px; border-radius:12px; background:#0b1220; border:1px solid #374151; }
    .big { font-size: 22px; font-weight: 700; }
    .muted { color:#9ca3af; font-size:12px; }
    button { margin-top:14px; width:100%; padding:12px; border-radius:12px; border:0; font-size:16px; font-weight:600; background:#22c55e; color:#052e12; }
    button:active { transform: scale(.99); }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Cents-per-Mile (CPM) Calculator</h1>

      <div class="row">
        <div>
          <label>Extra cost you’re paying (S$)</label>
          <input id="extraCost" inputmode="decimal" placeholder="e.g. 30.00" />
        </div>
        <div>
          <label>Miles earned (miles)</label>
          <input id="miles" inputmode="numeric" placeholder="e.g. 2000" />
        </div>
      </div>

      <label>Your “mile value” threshold (cpm)</label>
      <input id="threshold" inputmode="decimal" value="1.5" />

      <div class="out">
        <div class="muted">Cost per mile</div>
        <div class="big"><span id="cpm">—</span> cpm</div>
        <div class="muted" id="verdict">Enter numbers to see result.</div>
      </div>

      <button id="reset">Reset</button>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const extraCost = $("extraCost");
    const miles = $("miles");
    const threshold = $("threshold");
    const cpmEl = $("cpm");
    const verdictEl = $("verdict");

    function parseNum(v) {
      if (!v) return NaN;
      return Number(String(v).replace(/[^0-9.]/g, ""));
    }

    function calc() {
      const cost = parseNum(extraCost.value);
      const m = parseNum(miles.value);
      const th = parseNum(threshold.value);

      if (!isFinite(cost) || !isFinite(m) || m <= 0) {
        cpmEl.textContent = "—";
        verdictEl.textContent = "Enter numbers to see result.";
        return;
      }

      const cpm = (cost * 100) / m; // cents per mile
      cpmEl.textContent = cpm.toFixed(2);

      if (isFinite(th)) {
        verdictEl.textContent = cpm <= th
          ? `Worth it (≤ ${th.toFixed(2)} cpm).`
          : `Not worth it (> ${th.toFixed(2)} cpm).`;
      } else {
        verdictEl.textContent = "Set a threshold to get a verdict.";
      }

      // persist inputs
      localStorage.setItem("cpm.extraCost", extraCost.value);
      localStorage.setItem("cpm.miles", miles.value);
      localStorage.setItem("cpm.threshold", threshold.value);
    }

    // restore
    extraCost.value = localStorage.getItem("cpm.extraCost") || "";
    miles.value = localStorage.getItem("cpm.miles") || "";
    threshold.value = localStorage.getItem("cpm.threshold") || "1.5";

    [extraCost, miles, threshold].forEach(el => el.addEventListener("input", calc));
    $("reset").addEventListener("click", () => {
      extraCost.value = ""; miles.value = ""; threshold.value = "1.5";
      localStorage.removeItem("cpm.extraCost");
      localStorage.removeItem("cpm.miles");
      localStorage.removeItem("cpm.threshold");
      calc();
    });

    calc();

    // register service worker
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./sw.js");
    }
  </script>
</body>
</html>
